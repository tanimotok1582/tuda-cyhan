<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kochi Stellar Tide - ÊÇ†‰πÖ„ÅÆÊö¶</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200;300;400&family=Lato:wght@300&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #010105; --text-color: #e6f3ff; --accent-color: #b3d9ff; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg-color); color: var(--text-color); font-family: 'Noto Serif JP', serif; overflow: hidden; }
        canvas { position: fixed; top: 0; left: 0; z-index: 1; }
        #content { position: relative; z-index: 2; padding: 6vh 6vw; display: flex; flex-direction: column; justify-content: space-between; height: 100vh; box-sizing: border-box; pointer-events: none; }
        .header { border-left: 1px solid rgba(255,255,255,0.2); padding-left: 20px; pointer-events: auto; }
        .era-title { font-size: 1.6rem; letter-spacing: 0.3em; font-weight: 200; }
        .lunar-title { font-size: 0.9rem; opacity: 0.6; letter-spacing: 0.2em; margin-top: 8px; }
        .main-display { max-width: 650px; pointer-events: auto; cursor: pointer; transition: 0.5s ease; }
        .main-display:hover { transform: translateY(-5px); }
        .astro-label { font-size: 0.7rem; letter-spacing: 0.6em; color: var(--accent-color); opacity: 0.8; margin-bottom: 20px; display: block; }
        #astro-title { font-size: 3.2rem; margin: 0; font-weight: 200; line-height: 1.4; text-shadow: 0 0 20px rgba(255,255,255,0.2); }
        #astro-sub { font-size: 1.05rem; opacity: 0.8; margin-top: 25px; line-height: 2.2; letter-spacing: 0.05em; font-weight: 300; }
        #modal { display: none; position: fixed; z-index: 100; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); backdrop-filter: blur(20px); justify-content: center; align-items: center; }
        #modal.show { display: flex; animation: fadeIn 0.8s ease; }
        .modal-body { max-width: 500px; padding: 50px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <canvas id="sky-canvas"></canvas>
    <div id="content">
        <div class="header">
            <div class="era-title" id="era-display"></div>
            <div class="lunar-title">ÊóßÊö¶Ôºö<span id="lunar-display"></span> Ôºè Âúü‰Ωê‰πãÂúã È´òÁü•</div>
        </div>
        <div class="main-display" id="trigger-modal">
            <span class="astro-label">‰ªäÂ§ú„ÄÅË≤¥Êñπ„Å´Ë¶ã„Åõ„Åü„ÅÑÊòü</span>
            <h1 id="astro-title">Loading...</h1>
            <p id="astro-sub"></p>
            <div style="margin-top: 40px; font-family: 'Lato'; font-size: 0.7rem; letter-spacing: 0.4em; opacity: 0.4;">Koyomi & Starlight - Tap to Hear the Sea</div>
        </div>
        <div style="font-size: 0.6rem; opacity: 0.3; letter-spacing: 0.2em; display: flex; justify-content: space-between;">
            <span>STARRY TALE OF KOCHI</span>
            <span id="digital-clock"></span>
        </div>
    </div>
    <div id="modal">
        <div class="modal-body">
            <h2 id="modal-title" style="font-weight: 200; font-size: 2.2rem; margin-bottom: 30px;"></h2>
            <p id="modal-desc" style="line-height: 2.2; opacity: 0.9; font-weight: 300;"></p>
            <div id="close-modal" style="cursor:pointer; margin-top:40px; text-align:right; font-size:0.7rem; letter-spacing:0.3em; opacity:0.5;">Èñâ„Åò„Çã [√ó]</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('sky-canvas');
        const ctx = canvas.getContext('2d');
        let stars = [], shootingStars = [];
        let audioCtx;

        // --- 1. Â§©Êñá„Éá„Éº„Çø ---
        const ASTRO_DATA = {
            "02-03": { title: "Âπ∏„ÇíÈÅã„Å∂„ÄÅÂ∏ÉËâØÊòü", desc: "ÁØÄÂàÜ„ÅÆÂ§ú„ÄÅÈ´òÁü•„ÅÆÂçó„ÅÆÊ∞¥Âπ≥Á∑ö„Å´Áèæ„Çå„Çã„Ç´„Éé„Éº„Éó„Çπ„ÄÇÂà•Âêç„ÄéÂ∏ÉËâØÊòü„Äè„ÄÇ‰∏ÄÂ∫¶Ë¶ã„Çå„Å∞Èï∑ÂØø„ÇíÊéà„Åã„Çã„Å®Ë®Ä„Çè„Çå„Çã‰ºùË™¨„ÅÆ‰∏ÄÁ≠âÊòü„Åß„Åô„ÄÇÂÜ¨„ÅÆÁµÇ„Çè„Çä„ÇíÂëä„Åí„Çã„ÄÅÈùô„Åã„Å™ÂÖâ„Å´È°ò„ÅÑ„ÇíË®ó„Åó„Å¶„ÄÇ" },
            "02-04": { title: "Á´ãÊò•„ÄÅ„ÅØ„Åò„Åæ„Çä„ÅÆÊòéÊòü", desc: "‰ªäÊó•„Åã„ÇâÊö¶„ÅÆ‰∏ä„Åß„ÅØÊò•„ÄÇÂ§ïÊöÆ„Çå„ÅÆË•ø„ÅÆÁ©∫„Å´„ÅØÈáëÊòü„ÅåËºù„Åç„ÄÅÈ´òÁü•„ÅÆÂé≥„Åó„ÅÑÂÜ¨„ÅåÊòé„Åë„Çà„ÅÜ„Å®„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇÂØí„Åï„ÅÆ‰∏≠„Å´Ê∑∑„Åò„ÇãÊò•„ÅÆÂåÇ„ÅÑ„ÇíÊÑü„Åò„Å™„Åå„Çâ„ÄÅÊñ∞„Åó„ÅÑÊòüÁ©∫„ÅÆÂßã„Åæ„Çä„ÇíË¶ã‰∏ä„Åí„Åæ„Åó„Çá„ÅÜ„ÄÇ" },
            "02-05": { title: "„Åó„ÅóÂ∫ß„ÅÆ„É¨„Ç∞„É´„Çπ", desc: "Êù±„ÅÆÁ©∫„Å´„ÄÅÊò•„ÅÆÊòüÂ∫ß„ÅÆÁéã„Äé„Åó„ÅóÂ∫ß„Äè„ÅåÂßø„ÇíÁèæ„Åó„Åæ„Åô„ÄÇ„Åù„ÅÆÂøÉËáì„Å´Ëºù„Åè„É¨„Ç∞„É´„Çπ„ÅØ„ÄéÂ∞è„Åï„Å™Áéã„Äè„Å®„ÅÑ„ÅÜÊÑèÂë≥„ÄÇÈ´òÁü•„ÅÆÂ§ú„ÇÇ„ÄÅÂ∞ë„Åó„Åö„Å§Êò•„ÅÆËèØ„ÇÑ„Åã„Åï„ÇíÂ∏Ø„Å≥„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ" },
            "default": { title: "È´òÁü•„ÅÆÂÜ¨ÈäÄÊ≤≥", desc: "ÂÜ¨„ÅÆÂ§úÁ©∫„ÇíÂΩ©„ÇãÂ§ß‰∏âËßí„ÅåÂ§©È†Ç„Å´Ëºù„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇÈè°Â∑ù„ÅÆ„Åõ„Åõ„Çâ„Åé„ÄÅ„ÅÇ„Çã„ÅÑ„ÅØÂ§™Âπ≥Ê¥ã„ÅÆÊ≥¢Èü≥„ÄÇÈ´òÁü•„ÅÆÈ¢®ÊôØ„Å®„Å®„ÇÇ„Å´„ÄÅ„Åì„ÅÆÊòüÁ©∫„ÅØ‰ªä„ÇÇÊòî„ÇÇÂ§â„Çè„Çä„Å™„ÅèÁ∂ö„ÅÑ„Å¶„ÅÑ„Åæ„Åô„ÄÇ" }
        };

        // --- 2. BGM: Ê≥¢Èü≥„ÅÆÁîüÊàê (Web Audio API) ---
        function playOceanSweep() {
            if (audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            
            const createWave = () => {
                const bufferSize = audioCtx.sampleRate * 6;
                const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;

                const noise = audioCtx.createBufferSource();
                const filter = audioCtx.createBiquadFilter();
                const gain = audioCtx.createGain();

                filter.type = 'lowpass';
                filter.frequency.setValueAtTime(300, audioCtx.currentTime);
                filter.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 3);

                gain.gain.setValueAtTime(0, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.04, audioCtx.currentTime + 3);
                gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 6);

                noise.buffer = buffer;
                noise.connect(filter);
                filter.connect(gain);
                gain.connect(audioCtx.destination);
                noise.start();
            };

            setInterval(createWave, 7000);
            createWave();
        }

        // --- 3. ÊúàÈΩ¢Ë®àÁÆó ---
        function getLunarInfo(date) {
            const baseDate = new Date(1970, 0, 7);
            const diff = (date - baseDate) / (24 * 60 * 60 * 1000);
            const age = diff % 29.53;
            let icon = "";
            if (age < 1.8) icon = "üåë";
            else if (age < 5.5) icon = "üåí";
            else if (age < 9.2) icon = "üåì";
            else if (age < 13.0) icon = "üåî";
            else if (age < 16.6) icon = "üåï";
            else if (age < 20.3) icon = "üåñ";
            else if (age < 24.0) icon = "üåó";
            else icon = "üåò";
            return { age: Math.floor(age), icon: icon };
        }

        function updateDisplay() {
            const now = new Date();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const date = String(now.getDate()).padStart(2, '0');
            const key = `${month}-${date}`;

            const era = new Intl.DateTimeFormat('ja-JP-u-ca-japanese', { era: 'long', year: 'numeric', month: 'long', day: 'numeric' }).format(now);
            document.getElementById('era-display').innerText = era;

            const lunar = getLunarInfo(now);
            const lunarNames = ["Â∏´Ëµ∞", "Áù¶Êúà", "Â¶ÇÊúà", "Âº•Áîü", "ÂçØÊúà", "ÁöêÊúà", "Ê∞¥ÁÑ°Êúà", "ÊñáÊúà", "ËëâÊúà", "Èï∑Êúà", "Á•ûÁÑ°Êúà", "ÈúúÊúà"];
            document.getElementById('lunar-display').innerText = `${lunar.icon} ‰πôÂ∑≥ ${lunarNames[now.getMonth()]} ${lunar.age}Êó•`;

            const info = ASTRO_DATA[key] || ASTRO_DATA["default"];
            document.getElementById('astro-title').innerText = info.title;
            document.getElementById('astro-sub').innerText = info.desc;
            document.getElementById('modal-title').innerText = info.title;
            document.getElementById('modal-desc').innerText = info.desc;
            document.getElementById('digital-clock').innerText = now.toLocaleTimeString('ja-JP', {hour12:false});
        }

        // --- 4. ÊòüÁ©∫ÊºîÂá∫ ---
        function initSky() {
            canvas.width = window.innerWidth; canvas.height = window.innerHeight;
            const colors = ['#e6f3ff', '#ffffff', '#ffd9b3', '#b3d9ff'];
            stars = Array.from({length: 400}, () => ({
                x: Math.random()*canvas.width, y: Math.random()*canvas.height,
                size: Math.random()*1.3, opacity: Math.random(), blink: Math.random()*0.015,
                color: colors[Math.floor(Math.random() * colors.length)]
            }));
        }

        function createShootingStar() {
            const angle = Math.PI / 4 + (Math.random() - 0.5) * 0.15;
            shootingStars.push({
                x: Math.random()*canvas.width*0.8, y: 0,
                len: Math.random()*120+60, speed: Math.random()*7+5,
                opacity: 1, size: Math.random()*1.8+0.5, angle: angle
            });
        }

        function draw() {
            ctx.fillStyle = 'rgba(1, 1, 5, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            stars.forEach(s => {
                s.opacity += s.blink; if(s.opacity>1 || s.opacity<0.1) s.blink*=-1;
                ctx.fillStyle = s.color;
                ctx.globalAlpha = s.opacity;
                ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill();
            });
            ctx.globalAlpha = 1.0;

            shootingStars.forEach((ss, i) => {
                ctx.save();
                ctx.strokeStyle = `rgba(255, 255, 255, ${ss.opacity})`;
                ctx.lineWidth = ss.size; ctx.lineCap = 'round';
                ctx.shadowBlur = 8; ctx.shadowColor = 'white';
                ctx.beginPath(); ctx.moveTo(ss.x, ss.y);
                ctx.lineTo(ss.x + Math.cos(ss.angle)*ss.len, ss.y + Math.sin(ss.angle)*ss.len);
                ctx.stroke(); ctx.restore();
                ss.x += Math.cos(ss.angle)*ss.speed; ss.y += Math.sin(ss.angle)*ss.speed;
                ss.opacity -= 0.012; if(ss.opacity <= 0) shootingStars.splice(i, 1);
            });
            requestAnimationFrame(draw);
        }

        setInterval(createShootingStar, 8500);
        document.getElementById('trigger-modal').onclick = () => {
            document.getElementById('modal').classList.add('show');
            playOceanSweep();
        };
        document.getElementById('close-modal').onclick = () => document.getElementById('modal').classList.remove('show');
        window.addEventListener('resize', initSky);
        
        initSky(); draw(); updateDisplay();
        setInterval(updateDisplay, 1000);
    </script>
</body>
</html>
